<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Google Maps 위치 정보</title>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDxg42U8tFRwVWAk64COW-x5qfApBV6jLs"></script>
</head>
<body>
    <h1>Google Maps 위치 정보</h1>
    <div id="map" style="width: 100%; height: 500px;"></div>

    <script>
        let map;

        // 페이지 로드 시 초기화
        window.onload = async function () {
            initMap();
            await sendLocation();
        };

        // Google Maps 초기화
        function initMap() {
            map = new google.maps.Map(document.getElementById("map"), {
                center: { lat: 36.5, lng: 127.5 }, // 기본 중심 서울
                zoom: 7,
            });

            loadMarkers(); // 기존 마커 로드
        }

        // 위치 정보를 서버로 전송
        async function sendLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(async (position) => {
                    const lat = position.coords.latitude;
                    const lng = position.coords.longitude;

                    try {
                        // 서버로 위치 정보 전송
                        await axios.post('https://https://port-0-server1-m3howeoye65c6a57.sel4.cloudtype.app//location', {
                            latitude: lat,
                            longitude: lng,
                        });
                        console.log('위치 정보가 서버에 전송되었습니다.');
                        loadMarkers(); // 마커 새로 로드
                    } catch (error) {
                        console.error('위치 정보 전송 실패:', error);
                    }
                }, (error) => {
                    console.error('위치 정보를 가져오지 못했습니다:', error);
                });
            } else {
                alert('브라우저가 위치 정보를 지원하지 않습니다.');
            }
        }

        // 서버에서 위치 정보를 불러와 지도에 마커 표시
        async function loadMarkers() {
            try {
                const response = await axios.get('https://https://port-0-server1-m3howeoye65c6a57.sel4.cloudtype.app//locations');
                const locations = response.data;

                locations.forEach((location) => {
                    new google.maps.Marker({
                        position: { lat: location.latitude, lng: location.longitude },
                        map: map,
                    });
                });
            } catch (error) {
                console.error('마커를 로드하는 중 오류 발생:', error);
            }
        }
    </script>
</body>
</html>
